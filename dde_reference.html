<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API v9.72+: DDE Formula Reference</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
		var picked=getCookie("picked");
		if (picked != "") {
			if (!$(this).hasClass("active")) {
				var tabNum = $(this).index();
				var nthChild = picked;
				$("ul#tabs li.active").removeClass("active");
				$(this).addClass("active");
				$("ul#tab li.active").removeClass("active");
				$("ul#tab li:nth-child("+nthChild+")").addClass("active");
				$("ul#tabs li:nth-child("+nthChild+")").addClass("active");
				setCookie("picked", nthChild, 1);
			}
		}
		$("ul#tabs li").click(function(e){
			if (!$(this).hasClass("active")) {
			var tabNum = $(this).index();
			var nthChild = tabNum+1;
			$("ul#tabs li.active").removeClass("active");
			$(this).addClass("active");
			$("ul#tab li.active").removeClass("active");
			$("ul#tab li:nth-child("+nthChild+")").addClass("active");
			setCookie("picked", nthChild, 1);
		}
    });
});
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
} 
function checkCookie() {
    var picked=getCookie("picked");
    if (picked != "") {
        alert("Welcome again " + picked);
    }else{
        //username = prompt("Please enter your name:", "");
        if (picked != "" && picked != null) {
            setCookie("picked", 1, 365);
        }
    }
}
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></a></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li><li>Python</li></ul>
  </td>
  <!--BEGIN SS360 SEARCH-->
  <td>
	<div id="site-search-360" align="right" style="padding-left: 1em;">
		<input id="searchBox" type="search" placeholder="Search..." />
		<input id="ss360SearchButton" type="submit" />
	</div>
  </td>
  <!--END SS360 SEARCH-->
  <div id="contact-us" align="right">
	<td><a href="https://www.interactivebrokers.com/en/index.php?f=customerService&p=email" style="color:#C7C7C7;font-weight:bold;padding: 0 0 0 1em;">Contact us</a></td>
  </div>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dde_reference.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">DDE Formula Reference </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="dde_rt"></a>
Real Time Data</h1>
<table class="doxtable">
<tr>
<th>Attribute</th><th>Description </th></tr>
<tr>
<td>twsuser</td><td>The user name with which you logged into the TWS </td></tr>
<tr>
<td>requestId</td><td>The request unique identifier (any positive integer) </td></tr>
<tr>
<td>symbol</td><td>The contract symbol </td></tr>
<tr>
<td>sectype</td><td>The kind of contract </td></tr>
<tr>
<td>exchange</td><td>The exchange from which we want to pull the data from </td></tr>
<tr>
<td>currency</td><td>The contract currency </td></tr>
</table>
<h2><a class="anchor" id="dde_rt_request"></a>
Initial Request</h2>
<p>=S[twsuser]|tik!'id[reqestId]?req?[symbol]_[sectype]_[exchange]_[currency]_~/'</p>
<h2><a class="anchor" id="dde_rt_reception"></a>
Data Reception</h2>
<p>=S[twsuser]|tik!id[requestId]?bidSize</p>
<p>=S[twsuser]|tik!id[requestId]?bid</p>
<p>=S[twsuser]|tik!id[requestId]?ask</p>
<p>=S[twsuser]|tik!id[requestId]?askSize</p>
<p>=S[twsuser]|tik!id[requestId]?last</p>
<p>=S[twsuser]|tik!id[requestId]?lastSize</p>
<p>=S[twsuser]|tik!id[requestId]?high</p>
<p>=S[twsuser]|tik!id[requestId]?low</p>
<p>=S[twsuser]|tik!id[requestId]?volume</p>
<p>=S[twsuser]|tik!id[requestId]?close</p>
<p>=S[twsuser]|tik!id[requestId]?bidImpliedVol</p>
<h2><a class="anchor" id="dde_rt_reception_options"></a>
Option-specific Ticks</h2>
<p>=S[twsuser]|tik!id[requestId]?bidDelta</p>
<p>=S[twsuser]|tik!id[requestId]?askImpliedVol</p>
<p>=S[twsuser]|tik!id[requestId]?askDelta</p>
<p>=S[twsuser]|tik!id[requestId]?lastImpliedVol</p>
<p>=S[twsuser]|tik!id[requestId]?lastDelta</p>
<p>=S[twsuser]|tik!id[requestId]?modelVolatility</p>
<p>=S[twsuser]|tik!id[requestId]?modelDelta</p>
<p>=S[twsuser]|tik!id[requestId]?modelPrice</p>
<p>=S[twsuser]|tik!id[requestId]?pvDividend</p>
<p>=S[twsuser]|tik!id[requestId]?modelGamma</p>
<p>=S[twsuser]|tik!id[requestId]?modelVega</p>
<p>=S[twsuser]|tik!id[requestId]?modelTheta</p>
<p>=S[twsuser]|tik!id[requestId]?modelUndPrice</p>
<h1><a class="anchor" id="dde_hst"></a>
Historical Data</h1>
<p>In the example <a class="el" href="dde_historical_tutorial.html#dde_hst_receive">Receiving the data</a>, you pulled midpoint historical data for EUR.USD from TWS.</p>
<div class="image">
<img src="dde_hst_understanding.png" alt="dde_hst_understanding.png"/>
</div>
<p>Most of the formula’s components are self-explanatory with the exception of duration and bar sizes, which require very specific codes as listed below:</p>
<h2><a class="anchor" id="dde_hst_understanding_duration"></a>
Duration</h2>
<table class="doxtable">
<tr>
<th><b>Time Unit</b></th><th><b>Formula Abbreviation</b> </th></tr>
<tr>
<td>Seconds</td><td>S </td></tr>
<tr>
<td>Day</td><td>D </td></tr>
<tr>
<td>Week</td><td>W </td></tr>
<tr>
<td>Month</td><td>M </td></tr>
<tr>
<td>Year</td><td>Y </td></tr>
</table>
<h2><a class="anchor" id="dde_hst_understanding_barsize"></a>
Bar Sizes</h2>
<table class="doxtable">
<tr>
<th><b>Bar Size</b></th><th><b>Formula Parameter</b> </th></tr>
<tr>
<td>1 second</td><td>1 </td></tr>
<tr>
<td>5 seconds</td><td>2 </td></tr>
<tr>
<td>15 seconds</td><td>3 </td></tr>
<tr>
<td>30 seconds</td><td>4 </td></tr>
<tr>
<td>1 minute</td><td>5 </td></tr>
<tr>
<td>2 minutes</td><td>6 </td></tr>
<tr>
<td>5 minutes</td><td>7 </td></tr>
<tr>
<td>15 minutes</td><td>8 </td></tr>
<tr>
<td>30 minutes</td><td>9 </td></tr>
<tr>
<td>1 hour</td><td>10 </td></tr>
<tr>
<td>1 day</td><td>11 </td></tr>
</table>
<p>For available <b>whatToShow</b> parameters and detailed descriptions, please refer to the <a class="el" href="historical_bars.html#hd_what_to_show">Historical Data Types</a>.</p>
<p>Please also be mindful of the <a class="el" href="historical_limitations.html">Historical Data Limitations</a>.</p>
<h1><a class="anchor" id="dde_contracts"></a>
Contract Definitions</h1>
<p>The TWS DDE for Excel API lets you retrieve data for any instrument available in TWS. So far we have been using the simplest instrument of all: CASH. Using slight variations of the same formula, you can define any security type available in TWS.</p>
<h2><a class="anchor" id="dde_contracts_description"></a>
How to Find the Definition of a Contract</h2>
<p>The best way of finding a contract’s description is within the TWS itself. Within the TWS, you can easily check a contract’s description either by double clicking it or through the <b>Contract Info -&gt; Description</b> menu, which you access by right-clicking a contract in TWS:</p>
<div class="image">
<img src="contract_info_tws.png" alt="contract_info_tws.png"/>
</div>
<p>The description will then appear:</p>
<div class="image">
<img src="contract_description_tws_without_debug.png" alt="contract_description_tws_without_debug.png"/>
</div>
<h2><a class="anchor" id="dde_contracts_formulas"></a>
Formulas for Different Security Types</h2>
<p><em>Note: There are two different request types, i.e. "req1" and "req2", that differentiate in defining contracts with underlying Symbol (req1) or Local Symbol (req2) of the contract. While either request type can be used, the Local Symbol is most common for FUT, OPT and FOP.</em></p>
<p><em> Please find available contract parameters and sample contracts for each security type below:</em></p>
<p><b>FX Pairs</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req?[symbol]_[SecType]_[exchange]_[currency]_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id1?req?EUR_CASH_IDEALPRO_USD_~/'</p>
<p><b>STK</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req?[symbol]_[SecType]_[exchange]_[currency]_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id2?req?IBKR_STK_SMART_USD_~/'</p>
<p><b>FUT</b></p>
<p><b>FUT using the contract’s local symbol</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req2?[symbol]_[SecType]_[exchange]_[currency]_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id3?req2?ESZ6_FUT_GLOBEX_USD_~/'</p>
<p><b>FUT using underlying’s symbol, multiplier and expiration date</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req?[underlying_symbol]_[SecType]_[expiry]_[multiplier]_[exchange]_[currency]_~_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id3?req?ES_FUT_201612_50_GLOBEX_USD_~_~/'</p>
<p><b>OPT</b></p>
<p><b>OPT using the contract’s local symbol</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req2?[symbol]_[SecType]_[exchange]_[currency]_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id4?req2?C DBK DEC 16 1300_OPT_DTB_EUR_~/'</p>
<p><em>Note: The format of the option local symbol conforms to the <a href="http://ibkb.interactivebrokers.com/article/972" target="_blank">Option Symbology Initiative (OSI)</a>.</em></p>
<p><b>OPT using underlying’s symbol, multiplier and expiration date</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req?[underlying_symbol]_[SecType]_[expiry]_[strike]_[P/C]_[multiplier]_[exchange]_[currency]_~_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id4?req?DBK_OPT_20161216_13_C_100_DTB_EUR_~_~/'</p>
<p><b>FOP</b></p>
<p><b>FOP using the contract’s local symbol</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req2?[symbol]_[SecType]_[exchange]_[currency]_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id5?req2?XTZ6 C1100_FOP_GLOBEX_USD_~/'</p>
<p><b>FOP using underlying’s symbol, multiplier and expiration date</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req?[underlying_symbol]_[SecType]_[expiry]_[strike]_[P/C]_[multiplier]_[exchange]_[currency]_~_[tradingClass]/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id5?req?EUR_FOP_20161209_1.1_C_125000_GLOBEX_USD_~_XT/'</p>
<p><b>IND</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req?[symbol]_[SecType]_[exchange]_[currency]_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id6?req?ES_IND_GLOBEX_USD_~/'</p>
<p><b>BAG</b></p>
<p><em>Formula</em></p>
<p>=S[twsuser]|tik!'id[reqId]?req?[symbol]_[SecType]_[exchange]_[currency]_CMBLGS_[num of legs]_[legId]_[legQuantity]_[legAction]_[legExchange]_[legPrice]...CMBLGS_~/'</p>
<p><em>Example</em></p>
<p>=Ssample123|tik!'id7?req?</p>
<p>SPY_BAG_SMART_USD_CMBLGS_2_141149249_1_BUY_SMART_0_141149252_1_SELL_SMART_0_CMBLGS_~/'</p>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">This website uses cookies. By navigating through it you agree to the use of cookies. Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
<!--BEGIN !SS360 SEARCH-->
<script>
var ss360Config = {
    /********* General *********/
    siteId: 'tws-api-doc',
    animationSpeed: 250,
    themeColor: '#A02424',
    showErrors: false,
    /********* Search Box *********/
    searchBoxSelector: '#searchBox',
    searchBoxStyle: {
        text: {
            color: '#ffffff',
            size: '12px',
        },
        background: {
            color: '#000000',
        },
        padding: '8px',        
        icon: {
            image: undefined,
        },
        border: {
            color: '#464646',
            radius: '7px',
        },
        button: {
            text: ' ',
            icon: 'magnifier'
        }
    },
    placeholder: 'Search...',
    searchButton: '#ss360SearchButton',
    /********* Search Suggestions *********/
    showSearchSuggestions: true,
    suggestionsStyle: {
        text: {
            color: '#333333',
        },
        background: {
            color: '#ffffff'
        },
        padding: '10px',
        distanceFromTop: '7px',
        border: {
            color: '#dddddd',
            radius: '7px',
        },
    },
    showImagesSuggestions: true,
    numSuggestions: 6,
    maxQuerySuggestions: 3,
    minChars: 3,
    highlight: true,
    /********* Search Results *********/
    searchResults: undefined,
    searchResultsCaption: 'We found #COUNT# results for your query "#QUERY#"',
    numResults: 50,
    navigation: 'top',
    highlightQueryTerms: true,
    showImagesResults: true,
    showResultLink: true,
    resultLinksOpenNewTab: false,
    queryCorrectionText: 'Did you mean "#CORRECTION#"?',
    noResultsText: 'Sorry, we have not found any matches for your query.',
    otherContentGroupName: 'Other',
    ignoreOtherContentGroup: false,
    moreResultsButton: undefined,
    moreResultsPagingSize: 50,
    groupResults: true,
    loader: {
        type: 'circle'
    }
}
</script>
<script src="https://sitesearch360.com/cdn/sitesearch360-v10.min.js"></script>
<!--END !SS360 SEARCH-->
</body>
</html>
