<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API v9.72: One Cancels All</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
		var picked=getCookie("picked");
		if (picked != "") {
			if (!$(this).hasClass("active")) {
				var tabNum = $(this).index();
				var nthChild = picked;
				$("ul#tabs li.active").removeClass("active");
				$(this).addClass("active");
				$("ul#tab li.active").removeClass("active");
				$("ul#tab li:nth-child("+nthChild+")").addClass("active");
				$("ul#tabs li:nth-child("+nthChild+")").addClass("active");
				setCookie("picked", nthChild, 1);
			}
		}
		$("ul#tabs li").click(function(e){
			if (!$(this).hasClass("active")) {
			var tabNum = $(this).index();
			var nthChild = tabNum+1;
			$("ul#tabs li.active").removeClass("active");
			$(this).addClass("active");
			$("ul#tab li.active").removeClass("active");
			$("ul#tab li:nth-child("+nthChild+")").addClass("active");
			setCookie("picked", nthChild, 1);
		}
    });
});
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
} 
function checkCookie() {
    var picked=getCookie("picked");
    if (picked != "") {
        alert("Welcome again " + picked);
    }else{
        //username = prompt("Please enter your name:", "");
        if (picked != "" && picked != null) {
            setCookie("picked", 1, 365);
        }
    }
}
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></a></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li><li>Python</li></ul>
  </td>
  <td><a href="mailto:api@interactivebrokers.com?subject=TWS API Documentation" style="color:#C7C7C7;font-weight:bold;padding: 0 0 0 1em;">Contact us</a></td>
  <!--BEGIN GCS_SEARCHBOX-->
  <td style="position: absolute; right: 0;">
   <div id="google-custom-search" align="right" style="vertical-align: top;">
   <script>
  (function() {
    var cx = '002885114636493240026:q6smajphkxq';
	var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
	</script>
	<gcse:search newWindow="false" enableHistory="true"></gcse:search>
   </div>
   </td>
  <!--END !GCS_SEARCHBOX-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('oca.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">One Cancels All </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a href="https://www.interactivebrokers.com/en/index.php?f=583" target="_blank" class="linkexternal">One-Cancels All</a> (OCA) order type allows an investor to place multiple and possibly unrelated orders assigned to a group. The aim is to complete just one of the orders, which in turn will cause TWS to cancel the remaining orders. The investor may submit several orders aimed at taking advantage of the most desirable price within the group. Completion of one piece of the group order causes cancellation of the remaining group orders while partial completion causes the group to re-balance. An investor might desire to sell 1000 shares of only ONE of three positions held above prevailing market prices. The OCA order group allows the investor to enter prices at specified target levels and if one is completed, the other two will automatically cancel. Alternatively, an investor may wish to take a LONG position in eMini S&amp;P stock index futures in a falling market or else SELL US treasury futures at a more favorable price. Grouping the two orders using an OCA order type offers the investor two chances to enter a similar position, while only running the risk of taking on a single position.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Order&gt; OneCancelsAll(<span class="keywordtype">string</span> ocaGroup, List&lt;Order&gt; ocaOrders, <span class="keywordtype">int</span> ocaType)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">foreach</span> (Order o <span class="keywordflow">in</span> ocaOrders)</div>
<div class="line">            {</div>
<div class="line">                o.OcaGroup = ocaGroup;</div>
<div class="line">                o.OcaType = ocaType;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">return</span> ocaOrders;</div>
<div class="line">        }</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">            List&lt;Order&gt; ocaOrders = <span class="keyword">new</span> List&lt;Order&gt;();</div>
<div class="line">            ocaOrders.Add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 10));</div>
<div class="line">            ocaOrders.Add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 11));</div>
<div class="line">            ocaOrders.Add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 12));</div>
<div class="line">            OrderSamples.OneCancelsAll(<span class="stringliteral">&quot;TestOCA_&quot;</span> + nextOrderId, ocaOrders, 2);</div>
<div class="line">            <span class="keywordflow">foreach</span> (Order o <span class="keywordflow">in</span> ocaOrders)</div>
<div class="line">                client.placeOrder(nextOrderId++, ContractSamples.USStock(), o);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Order&gt; OneCancelsAll(String ocaGroup, List&lt;Order&gt; ocaOrders, <span class="keywordtype">int</span> ocaType) {</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (Order o : ocaOrders) {</div>
<div class="line">            o.ocaGroup(ocaGroup);</div>
<div class="line">            o.ocaType(ocaType);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> ocaOrders;</div>
<div class="line">    }</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        List&lt;Order&gt; OcaOrders = <span class="keyword">new</span> ArrayList&lt;Order&gt;();</div>
<div class="line">        OcaOrders.add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 10));</div>
<div class="line">        OcaOrders.add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 11));</div>
<div class="line">        OcaOrders.add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 12));</div>
<div class="line">        OcaOrders = OrderSamples.OneCancelsAll(<span class="stringliteral">&quot;TestOCA_&quot;</span> + nextOrderId, OcaOrders, 2);</div>
<div class="line">        <span class="keywordflow">for</span> (Order o : OcaOrders) {</div>
<div class="line">            </div>
<div class="line">            client.placeOrder(nextOrderId++, ContractSamples.USStock(), o);</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">            For Each o As Order In ocaOrders</div>
<div class="line"></div>
<div class="line">                o.OcaGroup = ocaGroup</div>
<div class="line">                o.OcaType = ocaType</div>
<div class="line">                <span class="stringliteral">&#39;Same as with Bracket orders. To prevent accidental executions, set all orders&#39;</span> transmit flag to <span class="keyword">false</span>.</div>
<div class="line">                <span class="stringliteral">&#39;This will tell the TWS Not to send the orders, allowing your program to send them all first.</span></div>
<div class="line"><span class="stringliteral">                o.Transmit = False</span></div>
<div class="line"><span class="stringliteral">            Next o</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            &#39;</span>Telling the TWS to transmit the last order in the OCA will also cause the transmission of its predecessors.</div>
<div class="line">            ocaOrders.Item(ocaOrders.Count - 1).Transmit = True</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        Dim ocaOrders As List(Of Order) = New List(Of Order)</div>
<div class="line">        ocaOrders.Add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 10))</div>
<div class="line">        ocaOrders.Add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 11))</div>
<div class="line">        ocaOrders.Add(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 12))</div>
<div class="line">        OrderSamples.OneCancelsAll(<span class="stringliteral">&quot;TestOCA_&quot;</span> + nextOrderId, ocaOrders, 2)</div>
<div class="line">        For Each o As Order In ocaOrders</div>
<div class="line">            client.placeOrder(increment(nextOrderId), ContractSamples.USStock(), o)</div>
<div class="line">        Next</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> OrderSamples::OneCancelsAll(std::string ocaGroup, Order&amp; ocaOrder, <span class="keywordtype">int</span> ocaType){</div>
<div class="line">        ocaOrder.ocaGroup = ocaGroup;</div>
<div class="line">        ocaOrder.ocaType = ocaType;</div>
<div class="line">}</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    std::vector&lt;Order&gt; ocaOrders;</div>
<div class="line">    ocaOrders.push_back(OrderSamples::LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 10));</div>
<div class="line">    ocaOrders.push_back(OrderSamples::LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 11));</div>
<div class="line">    ocaOrders.push_back(OrderSamples::LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 12));</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; ocaOrders.size(); i++){</div>
<div class="line">        OrderSamples::OneCancelsAll(<span class="stringliteral">&quot;TestOca&quot;</span>, ocaOrders[i], 2);</div>
<div class="line">        m_pClient-&gt;placeOrder(m_orderId++, ContractSamples::USStock(), ocaOrders[i]);</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    @staticmethod</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    <span class="keyword">def </span>OneCancelsAll(ocaGroup:str, ocaOrders:ListOfOrder, ocaType:int):</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        <span class="keywordflow">for</span> o <span class="keywordflow">in</span> ocaOrders:</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;            o.ocaGroup = ocaGroup</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            o.ocaType = ocaType</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        <span class="keywordflow">return</span> ocaOrders</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    </div>
</div><!-- fragment --> ... <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;        ocaOrders = []</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        ocaOrders.append(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 10))</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        ocaOrders.append(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 11))</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;        ocaOrders.append(OrderSamples.LimitOrder(<span class="stringliteral">&quot;BUY&quot;</span>, 1, 12))</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        OrderSamples.OneCancelsAll(<span class="stringliteral">&quot;TestOCA_&quot;</span> + self.nextValidOrderId, ocaOrders, 2)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        <span class="keywordflow">for</span> o <span class="keywordflow">in</span> ocaOrders:</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;            self.placeOrder(self.nextOrderId(), ContractSamples.USStock(), o)</div>
</div><!-- fragment -->  </li>
</ul>
<h1><a class="anchor" id="oca_types"></a>
OCA Types</h1>
<p>Via the <a class="el" href="classIBApi_1_1Order.html#a3485999c42d64f3c879ec4a424bab697">IBApi.Order.OcaType</a> attribute, the way in which remaining orders should be handled after an execution can be configured as indicated in the table below:</p>
<table class="doxtable">
<tr>
<th>Value</th><th>Description </th></tr>
<tr>
<td>1</td><td>Cancel all remaining orders with block.* </td></tr>
<tr>
<td>2</td><td>Remaining orders are proportionately reduced in size with block.* </td></tr>
<tr>
<td>3</td><td>Remaining orders are proportionately reduced in size with no block. </td></tr>
</table>
<p>Note*: if you use a value "with block" gives your order has overfill protection. This means that only one order in the group will be routed at a time to remove the possibility of an overfill.</p>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">This website uses cookies. By navigating through it you agree to the use of cookies. Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
<!--BEGIN GCS_SEARCHBOX-->
<style type='text/css'>
	.gsc-control-cse{
		font family: Arial, sans-serif;
		border-color: #000100;
		background-color: #000000;
		width:250px;
		height: 20px;
		padding-top: 6px;
	}
	input.gsc-search-button {
		background-color: #6D1800;
		color: #fff;
		cursor: pointer;
	}
	input.gsc-search-button:hover {
		background-color: #A02200;
	}
	td.gsc-clear-button {
		position: relative;
		right: 85px;
	}
  }
</style>
<!--END GCS_SEARCHBOX-->
</body>
</html>
